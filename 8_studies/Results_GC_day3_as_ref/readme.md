# DESeq2 script generated by iDEP on Mon Aug 12 15:07:11 2024
# Please cite https://doi.org/10.1186/s12859-018-2486-6

# R version 4.3.0 (2023-04-21)
if (!require("BiocManager", quietly = TRUE))
  install.packages("BiocManager")  # v. 1.30.20
if (!require("DESeq2", quietly = TRUE))
  BiocManager::install("DESeq2")  # v. 1.39.8
library(DESeq2) # D.E.G.
FC <- 2 # Fold-change cutoff
FDR <- 0.1 # FDR cutoff
alpha <- 0.1 # independent filtering, default

#  Prepare data --------------------
# Use the "Converted counts" button in the Pre-Process tab
# to download the filtered counts file with gene IDs converted to Ensembl.
raw_counts = read.csv("converted_counts_data.csv")
row.names(raw_counts) <- raw_counts$User_ID
raw_counts <- raw_counts[, -(1:3)] # delete 3 columns of IDs
str(raw_counts)

# Factors coded: Growthtime(Days) --> A, Treatment --> B, GenotyperealtivetoWTCol0 --> C, Accession --> D
col_data <- data.frame(
  "A" = c("8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "3", "3", "3", "3", "3", "3", "3", "3", "3", "3", "3", "3", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "13", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "8", "8", "8", "8", "8", "8", "8", "8", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "8", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "4", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11", "11"),
  "B" = c("SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "SPACEFLIGHT", "GROUNDCONTROL", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "GROUNDCONTROL", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "SPACEFLIGHT", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL", "GROUNDCONTROL"),
  "C" = c("WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "CVI0", "CVI0", "CVI0", "CVI0", "CVI0", "CVI0", "CVI0", "CVI0", "CVI0", "CVI0", "CVI0", "CVI0", "LER0", "LER0", "LER0", "LER0", "LER0", "LER0", "LER0", "LER0", "LER0", "LER0", "LER0", "LER0", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WS2", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "COL0PHYD", "COL0PHYD", "COL0PHYD", "COL0PHYD", "COL0PHYD", "COL0PHYD", "COL0PHYD", "COL0PHYD", "COL0PHYD", "COL0PHYD", "COL0PHYD", "COL0PHYD", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "COL0SKU6", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WS", "WS", "WS", "WS", "WS", "WS", "WS", "WSSKU5", "WSSKU5", "WS", "WSSKU5", "WSSKU5", "WSSKU5", "WSSKU5", "WSSKU5", "WSSKU5", "WS", "WS", "WS", "WSSKU5", "WS", "WS", "WSSKU5", "WS", "WS", "WSSKU5", "WS", "WSSKU5", "WSSKU5", "WSSKU5", "WSSKU5", "WSSKU5", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "WILDTYPE", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLELP25", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17", "COLMET17"),
  "D" = c("OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD37", "OSD38", "OSD38", "OSD38", "OSD38", "OSD38", "OSD38", "OSD38", "OSD38", "OSD38", "OSD38", "OSD38", "OSD38", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD120", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD193", "OSD217", "OSD217", "OSD217", "OSD217", "OSD217", "OSD217", "OSD217", "OSD217", "OSD217", "OSD217", "OSD217", "OSD217", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD218", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD281", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427", "OSD427")
)
row.names(col_data) <- colnames(raw_counts)
col_data

#Set reference level 
col_data[, 1] <- as.factor(col_data[, 1])
col_data[, 1] <- relevel(col_data[, 1], "3")
col_data[, 2] <- as.factor(col_data[, 2])
col_data[, 2] <- relevel(col_data[, 2], "GROUNDCONTROL")

# Run DESeq2--------------------
dds <- DESeq2::DESeqDataSetFromMatrix(
   countData = raw_counts,
   colData = col_data,
   design = ~  A + B + C  +  A:B 
)
dds = DESeq2::DESeq(dds) 

# Extract results--------------------

# Comparison 1 of 5:  SPACEFLIGHT-GROUNDCONTROL
res <- DESeq2::results(dds,
  contrast = c("B", "SPACEFLIGHT", "GROUNDCONTROL"),
  independentFiltering = TRUE,
  alpha = alpha
)
# Examine results 
summary(res)
plotMA(res)
plotCounts(dds, gene = which.min(res$padj), intgroup = colnames(col_data)[2])
res <- subset(res, padj < FDR & abs(log2FoldChange) > log2(FC)) # Select
table(sign(res$log2FoldChange)) # N. of genes Down, Up
res <- res[order(-res$log2FoldChange), ] #sort
head(res) #top upregulated
tail(res) #top downregulated

# Comparison 2 of 5:  A11.BSPACEFLIGHT
# Interaction term
res <- DESeq2::results(dds, name = "A11.BSPACEFLIGHT",
  independentFiltering = TRUE,
  alpha = alpha
)
# Examine results 
summary(res)
plotMA(res)
plotCounts(dds, gene = which.min(res$padj), intgroup = colnames(col_data)[2])
res <- subset(res, padj < FDR & abs(log2FoldChange) > log2(FC)) # Select
table(sign(res$log2FoldChange)) # N. of genes Down, Up
res <- res[order(-res$log2FoldChange), ] #sort
head(res) #top upregulated
tail(res) #top downregulated

# Comparison 3 of 5:  A13.BSPACEFLIGHT
# Interaction term
res <- DESeq2::results(dds, name = "A13.BSPACEFLIGHT",
  independentFiltering = TRUE,
  alpha = alpha
)
# Examine results 
summary(res)
plotMA(res)
plotCounts(dds, gene = which.min(res$padj), intgroup = colnames(col_data)[2])
res <- subset(res, padj < FDR & abs(log2FoldChange) > log2(FC)) # Select
table(sign(res$log2FoldChange)) # N. of genes Down, Up
res <- res[order(-res$log2FoldChange), ] #sort
head(res) #top upregulated
tail(res) #top downregulated

# Comparison 4 of 5:  A4.BSPACEFLIGHT
# Interaction term
res <- DESeq2::results(dds, name = "A4.BSPACEFLIGHT",
  independentFiltering = TRUE,
  alpha = alpha
)
# Examine results 
summary(res)
plotMA(res)
plotCounts(dds, gene = which.min(res$padj), intgroup = colnames(col_data)[2])
res <- subset(res, padj < FDR & abs(log2FoldChange) > log2(FC)) # Select
table(sign(res$log2FoldChange)) # N. of genes Down, Up
res <- res[order(-res$log2FoldChange), ] #sort
head(res) #top upregulated
tail(res) #top downregulated

# Comparison 5 of 5:  A8.BSPACEFLIGHT
# Interaction term
res <- DESeq2::results(dds, name = "A8.BSPACEFLIGHT",
  independentFiltering = TRUE,
  alpha = alpha
)
# Examine results 
summary(res)
plotMA(res)
plotCounts(dds, gene = which.min(res$padj), intgroup = colnames(col_data)[2])
res <- subset(res, padj < FDR & abs(log2FoldChange) > log2(FC)) # Select
table(sign(res$log2FoldChange)) # N. of genes Down, Up
res <- res[order(-res$log2FoldChange), ] #sort
head(res) #top upregulated
tail(res) #top downregulated

More results coming soon

![image](https://github.com/user-attachments/assets/794c6646-ddc0-49e1-a64f-4001b615cbd8)
